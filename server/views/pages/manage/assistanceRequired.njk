{% extends "partials/layout.njk" %}
{% from "partials/miniProfile/macro.njk" import miniProfile %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "partials/progress-tracker.njk" import progressTracker %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk/components/character-count/macro.njk" import govukCharacterCount %}

{% set pageTitle = "Will visitors need assistance?" %}

{% block content %}

  <div class="govuk-grid-row govuk-body">
    <div class="govuk-grid-column-three-quarters">
      {# Who is attending, time and place, visitors, review, booking complete #}
      {{ progressTracker(true, true, false, false, false) }}
      {{ miniProfile(prisoner) }}
    </div>
  </div>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-three-quarters">
      <span class="govuk-hint">Schedule an official visit</span>
      <h1 class="govuk-heading-l">Will visitors need assistance during their visit?</h1>
      <p>Add any important information about assistance needed for the official visit.</p>
      <p>Wing staff will be notified there is assistance needed for the visitor on the printed unlock list, but for confidentiality the full text will only be visible when you view the details of the official visit in this service.</p>
      <form method='POST'>
        <input type="hidden" name="_csrf" value="{{ csrfToken }}"/>

        {% set contactItems = [] %}
        {% for contact in contacts %}
          {% set contactItems = (contactItems.push(
            {
              name: "assistanceRequired[" + loop.index0 + "][id]",
              id: "assistanceRequired[" + loop.index0 + "][id]",
              value: contact.contactId,
              text: contact.firstName + " " + contact.lastName,
              checked: contact.assistedVisit,
              conditional: {
                html: govukCharacterCount({
                    maxlength: 400,
                    rows: 5,
                    id: "assistanceRequired[" + loop.index0 + "][notes]",
                    name: "assistanceRequired[" + loop.index0 + "][notes]",
                    value: contact.assistanceNotes,
                    errorMessage: validationErrors | findError("assistanceRequired[" + loop.index + "][notes]")
                  })
              }
            }
          ), contactItems) %}
        {% endfor %}

        {{ govukCheckboxes({
          name: "assistanceRequired",
          items: contactItems
        }) }}

        <div class="govuk-button-group">
          {{ govukButton({
                text: "Confirm",
                preventDoubleClick: true
            }) }}
          <a class="govuk-link govuk-link--no-visited-state" href="/">Cancel</a>
        </div>
      </form>
    </div>
  </div>
{% endblock %}
